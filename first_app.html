

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>First App: Hello Drone &mdash; 3DR Services 1.1.7beta documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="3DR Services 1.1.7beta documentation" href="index.html"/>
        <link rel="next" title="Additional Resources" href="resources.html"/>
        <link rel="prev" title="Getting Started" href="getting_started.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> 3DR Services</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#virtual-machine">Virtual Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#setting-up-sitl-on-linux">Setting up SITL on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#setting-up-your-android-studio-project">Setting up your Android Studio project</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#installing-3dr-services-on-your-mobile-device">Installing 3DR Services on your mobile device</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">First App: Hello Drone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#project-setup">Project setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-the-client-library">Adding the client library</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connecting-to-3dr-services">Connecting to 3DR Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connecting-to-a-drone-via-udp">Connecting to a drone via UDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connecting-via-usb-3dr-telemetry-radio">Connecting via USB (3DR Telemetry Radio)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-telemetry-from-your-drone">Getting telemetry from your drone</a></li>
<li class="toctree-l2"><a class="reference internal" href="#take-off">Take Off!</a></li>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Additional Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="resources.html#full-java-doc">Full Java Doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="resources.html#example-apps">Example Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="resources.html#questions">Questions</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">3DR Services</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>First App: Hello Drone</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/first_app.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="first-app-hello-drone">
<h1>First App: Hello Drone<a class="headerlink" href="#first-app-hello-drone" title="Permalink to this headline">¶</a></h1>
<p>In the first example, we&#8217;ll walk you through making an app that can connect to a drone, change Ardupilot modes, arm, take off and land the copter.</p>
<div class="section" id="project-setup">
<h2>Project setup<a class="headerlink" href="#project-setup" title="Permalink to this headline">¶</a></h2>
<p><em>Let&#8217;s set up a basic Android Studio project</em></p>
<img alt="_images/hellodrone_setup_1.png" src="_images/hellodrone_setup_1.png" />
<p><em>Make sure to use API 15 (Ice Cream Sandwich) or later</em></p>
<img alt="_images/hellodrone_setup_2.png" src="_images/hellodrone_setup_2.png" />
<p><em>Let&#8217;s start with a blank activity</em></p>
<img alt="_images/hellodrone_setup_3.png" src="_images/hellodrone_setup_3.png" />
<p><em>Click finish to create our project</em></p>
<img alt="_images/hellodrone_setup_4.png" src="_images/hellodrone_setup_4.png" />
</div>
<div class="section" id="adding-the-client-library">
<h2>Adding the client library<a class="headerlink" href="#adding-the-client-library" title="Permalink to this headline">¶</a></h2>
<p>Now open your <strong>build.gradle (Module:app)</strong> file and add:</p>
<div class="highlight-python"><div class="highlight"><pre>compile &#39;com.o3dr:3dr-services-lib:2.2.+&#39;
</pre></div>
</div>
<p>under the dependencies section.</p>
<img alt="_images/hellodrone_setup_5.png" src="_images/hellodrone_setup_5.png" />
<p>Then click <strong>Sync</strong> in the top right corner to re-sync the gradle.</p>
</div>
<div class="section" id="connecting-to-3dr-services">
<h2>Connecting to 3DR Services<a class="headerlink" href="#connecting-to-3dr-services" title="Permalink to this headline">¶</a></h2>
<p>Implement a TowerListener on your MainActivity to listen for events sent from 3DR Services to your app.</p>
<p>Result:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll">     <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="kd">implements</span> <span class="n">TowerListener</span> <span class="o">{</span>
</span>
             <span class="c1">// 3DR Services Listener</span>
<span class="hll">             <span class="nd">@Override</span>
</span><span class="hll">             <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTowerConnected</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">
</span><span class="hll">             <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">             <span class="nd">@Override</span>
</span><span class="hll">             <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTowerDisconnected</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">
</span><span class="hll">             <span class="o">}</span>
</span>
             <span class="nd">@Override</span>
             <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
                     <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
                     <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
             <span class="o">}</span>
     <span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Now we need to:</p>
<ol class="arabic simple">
<li>Add a ControlTower instance to manage the communication to 3DR Services.</li>
<li>Connect to 3DR Services on start, disconnect on stop of the MainAcvitity</li>
</ol>
<p>Result:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre>     <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="kd">implements</span> <span class="n">TowerListener</span> <span class="o">{</span>

<span class="hll">             <span class="kd">private</span> <span class="n">ControlTower</span> <span class="n">controlTower</span><span class="o">;</span>
</span>
             <span class="nd">@Override</span>
             <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
                     <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
                     <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

                     <span class="c1">// Initialize the service manager</span>
<span class="hll">                     <span class="k">this</span><span class="o">.</span><span class="na">controlTower</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ControlTower</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">());</span>
</span>
             <span class="o">}</span>

             <span class="nd">@Override</span>
             <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
                     <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
<span class="hll">                     <span class="k">this</span><span class="o">.</span><span class="na">controlTower</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span>
             <span class="o">}</span>

             <span class="nd">@Override</span>
             <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
                     <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
<span class="hll">                     <span class="k">this</span><span class="o">.</span><span class="na">controlTower</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
</span>             <span class="o">}</span>

<span class="hll">             <span class="nd">@Override</span>
</span><span class="hll">             <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTowerConnected</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">
</span><span class="hll">             <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">             <span class="nd">@Override</span>
</span><span class="hll">             <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTowerDisconnected</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">
</span><span class="hll">             <span class="o">}</span>
</span>
             <span class="nd">@Override</span>
             <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
                     <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
                     <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

             <span class="o">}</span>
     <span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="connecting-to-a-drone-via-udp">
<h2>Connecting to a drone via UDP<a class="headerlink" href="#connecting-to-a-drone-via-udp" title="Permalink to this headline">¶</a></h2>
<p>Make sure you have your SITL instance running and power up a simulated drone with a UDP output to the IP of your Android device.</p>
<p>For our example, we&#8217;ll simulate a drone in Berkeley, display the telemetry console and set our output IP to our Android testing device.</p>
<p>You can find the IP for your Android device in Settings &gt; Wi-Fi. Tap on the connection to get information about it.</p>
<p>In the Linux instance that has SITL installed, go to your terminal.</p>
<p>Navigate to the folder where you cloned the ardupilot repo into.</p>
<p>Enter the following in your console:</p>
<div class="highlight-python"><div class="highlight"><pre>sim_vehicle.sh -L 3DRBerkeley --console  --out &lt;ANDROID_DEVICE_IP&gt;:14550
</pre></div>
</div>
<p>Let&#8217;s add some code in our app to connect to a drone.</p>
<p>First, declare that your MainActivity can act as an interface for DroneListener and implement some methods to listen for drone events.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="kd">implements</span> <span class="n">DroneListener</span><span class="o">,</span> <span class="n">TowerListener</span> <span class="o">{</span>
</span><span class="hll">        <span class="nd">@Override</span>
</span><span class="hll">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDroneEvent</span><span class="o">(</span><span class="n">String</span> <span class="n">event</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="nd">@Override</span>
</span><span class="hll">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDroneConnectionFailed</span><span class="o">(</span><span class="n">ConnectionResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="nd">@Override</span>
</span><span class="hll">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDroneServiceInterrupted</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMsg</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="o">}</span>
</span>
        <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Next, let&#8217;s add an instance variable to keep track of our drone instance to the top of our MainActivity.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="kd">implements</span> <span class="n">DroneListener</span><span class="o">,</span> <span class="n">TowerListener</span> <span class="o">{</span>
<span class="hll">        <span class="kd">private</span> <span class="n">Drone</span> <span class="n">drone</span><span class="o">;</span>
</span><span class="hll">        <span class="kd">private</span> <span class="kt">int</span> <span class="n">droneType</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="na">TYPE_UNKNOWN</span><span class="o">;</span>
</span></pre></div>
</td></tr></table></div>
<p>The Drone instance will need a generic Android handler to register with the control tower. Let&#8217;s go ahead and add a handler right where we declare our instance variables.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="kd">implements</span> <span class="n">DroneListener</span><span class="o">,</span> <span class="n">TowerListener</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">Drone</span> <span class="n">drone</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">droneType</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="na">TYPE_UNKNOWN</span><span class="o">;</span>
<span class="hll">        <span class="kd">private</span> <span class="kd">final</span> <span class="n">Handler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">();</span>
</span></pre></div>
</td></tr></table></div>
<p>Let&#8217;s now instantiate a new drone upon the creation of our MainActivity.
After creation, the new drone will need to be registered with the control tower to be active.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="k">this</span><span class="o">.</span><span class="na">serviceManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceManager</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">());</span>
<span class="hll">        <span class="k">this</span><span class="o">.</span><span class="na">drone</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Drone</span><span class="o">();</span>
</span><span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTowerConnected</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">controlTower</span><span class="o">.</span><span class="na">registerDrone</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">handler</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">registerDroneListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Also, let&#8217;s make sure that when the MainActivity is stopped, we unregister our drone from the control tower.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
<span class="hll">        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
</span><span class="hll">                <span class="n">updateConnectedButton</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll">        <span class="k">this</span><span class="o">.</span><span class="na">controlTower</span><span class="o">.</span><span class="na">unregisterDrone</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">);</span>
</span>        <span class="k">this</span><span class="o">.</span><span class="na">controlTower</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Now let&#8217;s add a button in our activity_main.xml that will connect to a drone on press. Open your <strong>activity_main.xml</strong> file and add the following:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;Button</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;150dp&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:text=</span><span class="s">&quot;Connect&quot;</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/btnConnect&quot;</span>
        <span class="na">android:onClick=</span><span class="s">&quot;onBtnConnectTap&quot;</span>
        <span class="na">android:layout_alignParentRight=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:layout_alignParentEnd=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Open your <strong>MainActivity</strong> java source and add a method to handle the connect button press:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBtnConnectTap</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="hll">                <span class="n">Bundle</span> <span class="n">extraParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="o">();</span>
</span><span class="hll">                <span class="n">extraParams</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="n">ConnectionType</span><span class="o">.</span><span class="na">EXTRA_UDP_SERVER_PORT</span><span class="o">,</span> <span class="mi">14550</span><span class="o">);</span> <span class="c1">// Set default port to 14550</span>
</span><span class="hll">
</span><span class="hll">                <span class="n">ConnectionParameter</span> <span class="n">connectionParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionParameter</span><span class="o">(</span><span class="n">ConnectionType</span><span class="o">.</span><span class="na">TYPE_UDP</span><span class="o">,</span> <span class="n">extraParams</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class="hll">                <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">connectionParams</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll"><span class="o">}</span>
</span></pre></div>
</td></tr></table></div>
<p>Let&#8217;s see what&#8217;s going on in the above method.</p>
<p>First if we are connected, then use this button to disconnect.</p>
<p>If we are not connected, we need to build a set of connection parameters and connect.</p>
<p>Now let&#8217;s add som UI to alert us when the drone is connected.</p>
<p>Add the following UI helper method to the bottom of your MainActivity file.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">alertUser</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">message</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class="hll"><span class="o">}</span>
</span><span class="hll">
</span><span class="hll"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateConnectedButton</span><span class="o">(</span><span class="n">Boolean</span> <span class="n">isConnected</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">Button</span> <span class="n">connectButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnConnect</span><span class="o">);</span>
</span><span class="hll">        <span class="k">if</span> <span class="o">(</span><span class="n">isConnected</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">                <span class="n">connectButton</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;Disconnect&quot;</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="hll">                <span class="n">connectButton</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;Connect&quot;</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll"><span class="o">}</span>
</span></pre></div>
</td></tr></table></div>
<p>Let&#8217;s revisit the <strong>onDroneEvent</strong> method to alert the user when the drone is connected.</p>
<p>Add the following to your <strong>onDroneEvent</strong> method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDroneEvent</span><span class="o">(</span><span class="n">String</span> <span class="n">event</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="o">)</span> <span class="o">{</span>
<span class="hll">        <span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_CONNECTED</span><span class="o">:</span>
</span><span class="hll">                        <span class="n">alertUser</span><span class="o">(</span><span class="s">&quot;Drone Connected&quot;</span><span class="o">);</span>
</span><span class="hll">                        <span class="n">updateConnectedButton</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">());</span>
</span><span class="hll">                        <span class="k">break</span><span class="o">;</span>
</span><span class="hll">
</span><span class="hll">                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_DISCONNECTED</span><span class="o">:</span>
</span><span class="hll">                        <span class="n">alertUser</span><span class="o">(</span><span class="s">&quot;Drone Disconnected&quot;</span><span class="o">);</span>
</span><span class="hll">                        <span class="n">updateConnectedButton</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">());</span>
</span><span class="hll">                        <span class="k">break</span><span class="o">;</span>
</span><span class="hll">
</span><span class="hll"><span class="nl">                default:</span>
</span><span class="hll">                        <span class="k">break</span><span class="o">;</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Now if you run the app and the SITL environment, you should be able to connect to your drone!</p>
</div>
<div class="section" id="connecting-via-usb-3dr-telemetry-radio">
<h2>Connecting via USB (3DR Telemetry Radio)<a class="headerlink" href="#connecting-via-usb-3dr-telemetry-radio" title="Permalink to this headline">¶</a></h2>
<p>For USB connections, you need to define an extra param for the baud rate.</p>
<p>Example:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">Bundle</span> <span class="n">extraParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="o">();</span>
<span class="n">extraParams</span><span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="n">ConnectionType</span><span class="o">.</span><span class="na">EXTRA_USB_BAUD_RATE</span><span class="o">,</span> <span class="mi">57600</span><span class="o">);</span> <span class="c1">// Set default baud rate to 57600</span>
<span class="n">ConnectionParameter</span> <span class="n">connectionParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConnectionParameter</span><span class="o">(</span><span class="n">ConnectionType</span><span class="o">.</span><span class="na">TYPE_USB</span><span class="o">,</span> <span class="n">extraParams</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">connectionParams</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="getting-telemetry-from-your-drone">
<h2>Getting telemetry from your drone<a class="headerlink" href="#getting-telemetry-from-your-drone" title="Permalink to this headline">¶</a></h2>
<p>In order to get telemetry updates from the drone, we need to add cases for different drone events returned in <strong>onDroneEvent</strong>.</p>
<p>Update your <strong>onDroneEvent</strong> to look like the following:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDroneEvent</span><span class="o">(</span><span class="n">String</span> <span class="n">event</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_CONNECTED</span><span class="o">:</span>
                        <span class="n">alertUser</span><span class="o">(</span><span class="s">&quot;Drone Connected&quot;</span><span class="o">);</span>
                        <span class="n">updateConnectedButton</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">());</span>
                        <span class="k">break</span><span class="o">;</span>

                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_DISCONNECTED</span><span class="o">:</span>
                        <span class="n">alertUser</span><span class="o">(</span><span class="s">&quot;Drone Disconnected&quot;</span><span class="o">);</span>
                        <span class="n">updateConnectedButton</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">());</span>
                        <span class="k">break</span><span class="o">;</span>

<span class="hll">                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_VEHICLE_MODE</span><span class="o">:</span>
</span><span class="hll">                        <span class="n">updateVehicleMode</span><span class="o">();</span>
</span><span class="hll">                        <span class="k">break</span><span class="o">;</span>
</span><span class="hll">
</span><span class="hll">                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">TYPE_UPDATED</span><span class="o">:</span>
</span><span class="hll">                        <span class="n">Type</span> <span class="n">newDroneType</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">);</span>
</span><span class="hll">                        <span class="k">if</span> <span class="o">(</span><span class="n">newDroneType</span><span class="o">.</span><span class="na">getDroneType</span><span class="o">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">.</span><span class="na">droneType</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">                                <span class="k">this</span><span class="o">.</span><span class="na">droneType</span> <span class="o">=</span> <span class="n">newDroneType</span><span class="o">.</span><span class="na">getDroneType</span><span class="o">();</span>
</span><span class="hll">                                <span class="n">updateVehicleModesForType</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">droneType</span><span class="o">);</span>
</span><span class="hll">                        <span class="o">}</span>
</span><span class="hll">                        <span class="k">break</span><span class="o">;</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll">                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">SPEED_UPDATED</span><span class="o">:</span>
</span><span class="hll">                        <span class="n">updateAltitude</span><span class="o">();</span>
</span><span class="hll">                        <span class="n">updateSpeed</span><span class="o">();</span>
</span><span class="hll">                        <span class="k">break</span><span class="o">;</span>
</span><span class="hll">
</span><span class="hll">                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">HOME_UPDATED</span><span class="o">:</span>
</span><span class="hll">                        <span class="n">updateDistanceFromHome</span><span class="o">();</span>
</span><span class="hll">                        <span class="k">break</span><span class="o">;</span>
</span>
<span class="nl">                default:</span>
                        <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Let&#8217;s add some TextViews to our UI in order to output telemetry values. In your <strong>activity_main.xml</strong> add the following:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;TableLayout</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;200dp&quot;</span>
        <span class="na">android:layout_below=</span><span class="s">&quot;@+id/telemetryLabel&quot;</span>
        <span class="na">android:layout_alignParentLeft=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:layout_alignParentStart=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:layout_marginTop=</span><span class="s">&quot;10dp&quot;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;TableRow</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/vehTelemRow1&quot;</span><span class="nt">&gt;</span>

                <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">&quot;100dp&quot;</span>
                        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                        <span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span>
                        <span class="na">android:text=</span><span class="s">&quot;Mode:&quot;</span>
                        <span class="na">android:id=</span><span class="s">&quot;@+id/vehicleModeLabelTextView&quot;</span>
                        <span class="na">android:layout_column=</span><span class="s">&quot;0&quot;</span>
                        <span class="na">android:paddingTop=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:paddingBottom=</span><span class="s">&quot;5dp&quot;</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;Spinner</span>
                        <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
                        <span class="na">android:layout_height=</span><span class="s">&quot;44dp&quot;</span>
                        <span class="na">android:id=</span><span class="s">&quot;@+id/modeSelect&quot;</span>
                        <span class="na">android:spinnerMode=</span><span class="s">&quot;dropdown&quot;</span>
                        <span class="na">android:layout_below=</span><span class="s">&quot;@+id/connectionTypeLabel&quot;</span>
                        <span class="na">android:layout_toLeftOf=</span><span class="s">&quot;@+id/btnConnect&quot;</span>
                        <span class="na">android:layout_alignParentLeft=</span><span class="s">&quot;true&quot;</span>
                        <span class="na">android:layout_alignParentStart=</span><span class="s">&quot;true&quot;</span>
                        <span class="na">android:layout_column=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/TableRow&gt;</span>

        <span class="nt">&lt;TableRow</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/vehTelemRow2&quot;</span><span class="nt">&gt;</span>

                <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">&quot;100dp&quot;</span>
                        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                        <span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span>
                        <span class="na">android:text=</span><span class="s">&quot;Altitude:&quot;</span>
                        <span class="na">android:id=</span><span class="s">&quot;@+id/altitudeLabelTextView&quot;</span>
                        <span class="na">android:layout_column=</span><span class="s">&quot;0&quot;</span>
                        <span class="na">android:paddingTop=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:paddingBottom=</span><span class="s">&quot;5dp&quot;</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
                        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                        <span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span>
                        <span class="na">android:text=</span><span class="s">&quot;0m&quot;</span>
                        <span class="na">android:id=</span><span class="s">&quot;@+id/altitudeValueTextView&quot;</span>
                        <span class="na">android:layout_column=</span><span class="s">&quot;1&quot;</span>
                        <span class="na">android:paddingTop=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:paddingBottom=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:layout_gravity=</span><span class="s">&quot;left&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/TableRow&gt;</span>

        <span class="nt">&lt;TableRow</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/vehTelemRow3&quot;</span><span class="nt">&gt;</span>

                <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">&quot;100dp&quot;</span>
                        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                        <span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span>
                        <span class="na">android:text=</span><span class="s">&quot;Speed:&quot;</span>
                        <span class="na">android:id=</span><span class="s">&quot;@+id/speedLabelTextView&quot;</span>
                        <span class="na">android:layout_column=</span><span class="s">&quot;0&quot;</span>
                        <span class="na">android:paddingTop=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:paddingBottom=</span><span class="s">&quot;5dp&quot;</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
                        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                        <span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span>
                        <span class="na">android:text=</span><span class="s">&quot;0m/s&quot;</span>
                        <span class="na">android:id=</span><span class="s">&quot;@+id/speedValueTextView&quot;</span>
                        <span class="na">android:layout_column=</span><span class="s">&quot;1&quot;</span>
                        <span class="na">android:paddingTop=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:paddingBottom=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:layout_gravity=</span><span class="s">&quot;left&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/TableRow&gt;</span>

        <span class="nt">&lt;TableRow</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/vehTelemRow4&quot;</span><span class="nt">&gt;</span>

                <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">&quot;100dp&quot;</span>
                        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                        <span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span>
                        <span class="na">android:text=</span><span class="s">&quot;Distance:&quot;</span>
                        <span class="na">android:id=</span><span class="s">&quot;@+id/distanceLabelTextView&quot;</span>
                        <span class="na">android:layout_column=</span><span class="s">&quot;0&quot;</span>
                        <span class="na">android:paddingTop=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:paddingBottom=</span><span class="s">&quot;5dp&quot;</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;TextView</span>
                        <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
                        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                        <span class="na">android:textAppearance=</span><span class="s">&quot;?android:attr/textAppearanceMedium&quot;</span>
                        <span class="na">android:text=</span><span class="s">&quot;0m&quot;</span>
                        <span class="na">android:id=</span><span class="s">&quot;@+id/distanceValueTextView&quot;</span>
                        <span class="na">android:layout_column=</span><span class="s">&quot;1&quot;</span>
                        <span class="na">android:paddingTop=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:paddingBottom=</span><span class="s">&quot;5dp&quot;</span>
                        <span class="na">android:layout_gravity=</span><span class="s">&quot;left&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/TableRow&gt;</span>

<span class="nt">&lt;/TableLayout&gt;</span>
</pre></div>
</div>
<p>In the above layout code, we are adding a table with TextViews and a Spinner Dropdown view that will let us change our vehicle&#8217;s modes.</p>
<p>Also add a class level Spinner variable in MainActivity so we can reference it throughout the code.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">ActionBarActivity</span> <span class="kd">implements</span> <span class="n">DroneListener</span><span class="o">,</span> <span class="n">TowerListener</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">Drone</span> <span class="n">drone</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">droneType</span> <span class="o">=</span> <span class="n">Type</span><span class="o">.</span><span class="na">TYPE_UNKNOWN</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">Handler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">();</span>
<span class="hll">        <span class="n">Spinner</span> <span class="n">modeSelector</span><span class="o">;</span>
</span></pre></div>
</td></tr></table></div>
<p>And add to our <strong>onCreate</strong> method to reference the Spinner defined in the XML layout:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">Context</span> <span class="n">context</span> <span class="o">=</span> <span class="n">getApplicationContext</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">controlTower</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ControlTower</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">drone</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Drone</span><span class="o">();</span>

<span class="hll">        <span class="k">this</span><span class="o">.</span><span class="na">modeSelector</span> <span class="o">=</span> <span class="o">(</span><span class="n">Spinner</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">modeSelect</span><span class="o">);</span>
</span><span class="hll">        <span class="k">this</span><span class="o">.</span><span class="na">modeSelector</span><span class="o">.</span><span class="na">setOnItemSelectedListener</span><span class="o">(</span><span class="k">new</span> <span class="n">Spinner</span><span class="o">.</span><span class="na">OnItemSelectedListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">                <span class="nd">@Override</span>
</span><span class="hll">                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onItemSelected</span><span class="o">(</span><span class="n">AdapterView</span><span class="o">&lt;?&gt;</span> <span class="n">parent</span><span class="o">,</span> <span class="n">View</span> <span class="n">view</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">                        <span class="n">onFlightModeSelected</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
</span><span class="hll">                <span class="o">}</span>
</span><span class="hll">                <span class="nd">@Override</span>
</span><span class="hll">                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onNothingSelected</span><span class="o">(</span><span class="n">AdapterView</span><span class="o">&lt;?&gt;</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">                        <span class="c1">// Do nothing</span>
</span><span class="hll">                <span class="o">}</span>
</span><span class="hll">        <span class="o">});</span>
</span><span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Now let&#8217;s implement some of the methods in our <strong>onDroneEvent</strong> in order to update our UI. Add the following methods to your MainActivity.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFlightModeSelected</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">VehicleMode</span> <span class="n">vehicleMode</span> <span class="o">=</span> <span class="o">(</span><span class="n">VehicleMode</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">modeSelector</span><span class="o">.</span><span class="na">getSelectedItem</span><span class="o">();</span>
</span><span class="hll">        <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">changeVehicleMode</span><span class="o">(</span><span class="n">vehicleMode</span><span class="o">);</span>
</span><span class="hll"><span class="o">}</span>
</span><span class="hll">
</span><span class="hll"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateVehicleModesForType</span><span class="o">(</span><span class="kt">int</span> <span class="n">droneType</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">List</span><span class="o">&lt;</span><span class="n">VehicleMode</span><span class="o">&gt;</span> <span class="n">vehicleModes</span> <span class="o">=</span>  <span class="n">VehicleMode</span><span class="o">.</span><span class="na">getVehicleModePerDroneType</span><span class="o">(</span><span class="n">droneType</span><span class="o">);</span>
</span><span class="hll">        <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">VehicleMode</span><span class="o">&gt;</span> <span class="n">vehicleModeArrayAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">VehicleMode</span><span class="o">&gt;(</span><span class="k">this</span><span class="o">,</span> <span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">simple_spinner_item</span><span class="o">,</span> <span class="n">vehicleModes</span><span class="o">);</span>
</span><span class="hll">        <span class="n">vehicleModeArrayAdapter</span><span class="o">.</span><span class="na">setDropDownViewResource</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">simple_spinner_dropdown_item</span><span class="o">);</span>
</span><span class="hll">        <span class="k">this</span><span class="o">.</span><span class="na">modeSelector</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">vehicleModeArrayAdapter</span><span class="o">);</span>
</span><span class="hll"><span class="o">}</span>
</span><span class="hll">
</span><span class="hll"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateVehicleMode</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">State</span> <span class="n">vehicleState</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">STATE</span><span class="o">);</span>
</span><span class="hll">        <span class="n">VehicleMode</span> <span class="n">vehicleMode</span> <span class="o">=</span> <span class="n">vehicleState</span><span class="o">.</span><span class="na">getVehicleMode</span><span class="o">();</span>
</span><span class="hll">        <span class="n">ArrayAdapter</span> <span class="n">arrayAdapter</span> <span class="o">=</span> <span class="o">(</span><span class="n">ArrayAdapter</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">modeSelector</span><span class="o">.</span><span class="na">getAdapter</span><span class="o">();</span>
</span><span class="hll">        <span class="k">this</span><span class="o">.</span><span class="na">modeSelector</span><span class="o">.</span><span class="na">setSelection</span><span class="o">(</span><span class="n">arrayAdapter</span><span class="o">.</span><span class="na">getPosition</span><span class="o">(</span><span class="n">vehicleMode</span><span class="o">));</span>
</span><span class="hll"><span class="o">}</span>
</span><span class="hll">
</span><span class="hll"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateAltitude</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">TextView</span> <span class="n">altitudeTextView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">altitudeValueTextView</span><span class="o">);</span>
</span><span class="hll">        <span class="n">Altitude</span> <span class="n">droneAltitude</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">ALTITUDE</span><span class="o">);</span>
</span><span class="hll">        <span class="n">altitudeTextView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%3.1f&quot;</span><span class="o">,</span> <span class="n">droneAltitude</span><span class="o">.</span><span class="na">getAltitude</span><span class="o">())</span> <span class="o">+</span> <span class="s">&quot;m&quot;</span><span class="o">);</span>
</span><span class="hll"><span class="o">}</span>
</span><span class="hll">
</span><span class="hll"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateSpeed</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">TextView</span> <span class="n">speedTextView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">speedValueTextView</span><span class="o">);</span>
</span><span class="hll">        <span class="n">Speed</span> <span class="n">droneSpeed</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">SPEED</span><span class="o">);</span>
</span><span class="hll">        <span class="n">speedTextView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%3.1f&quot;</span><span class="o">,</span> <span class="n">droneSpeed</span><span class="o">.</span><span class="na">getGroundSpeed</span><span class="o">())</span> <span class="o">+</span> <span class="s">&quot;m/s&quot;</span><span class="o">);</span>
</span><span class="hll"><span class="o">}</span>
</span><span class="hll">
</span><span class="hll"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateDistanceFromHome</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">TextView</span> <span class="n">distanceTextView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">distanceValueTextView</span><span class="o">);</span>
</span><span class="hll">        <span class="n">Altitude</span> <span class="n">droneAltitude</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">ALTITUDE</span><span class="o">);</span>
</span><span class="hll">        <span class="kt">double</span> <span class="n">vehicleAltitude</span> <span class="o">=</span> <span class="n">droneAltitude</span><span class="o">.</span><span class="na">getAltitude</span><span class="o">();</span>
</span><span class="hll">        <span class="n">Gps</span> <span class="n">droneGps</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">GPS</span><span class="o">);</span>
</span><span class="hll">        <span class="n">LatLong</span> <span class="n">vehiclePosition</span> <span class="o">=</span> <span class="n">droneGps</span><span class="o">.</span><span class="na">getPosition</span><span class="o">();</span>
</span><span class="hll">
</span><span class="hll">        <span class="kt">double</span> <span class="n">distanceFromHome</span> <span class="o">=</span>  <span class="mi">0</span><span class="o">;</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="o">(</span><span class="n">droneGps</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="n">LatLongAlt</span> <span class="n">vehicle3DPosition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LatLongAlt</span><span class="o">(</span><span class="n">vehiclePosition</span><span class="o">.</span><span class="na">getLatitude</span><span class="o">(),</span> <span class="n">vehiclePosition</span><span class="o">.</span><span class="na">getLongitude</span><span class="o">(),</span> <span class="n">vehicleAltitude</span><span class="o">);</span>
</span><span class="hll">                <span class="n">Home</span> <span class="n">droneHome</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">HOME</span><span class="o">);</span>
</span><span class="hll">                <span class="n">distanceFromHome</span> <span class="o">=</span> <span class="n">distanceBetweenPoints</span><span class="o">(</span><span class="n">droneHome</span><span class="o">.</span><span class="na">getCoordinate</span><span class="o">(),</span> <span class="n">vehicle3DPosition</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="hll">                <span class="n">distanceFromHome</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">distanceTextView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%3.1f&quot;</span><span class="o">,</span> <span class="n">distanceFromHome</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;m&quot;</span><span class="o">);</span>
</span><span class="hll"><span class="o">}</span>
</span><span class="hll">
</span><span class="hll"><span class="kd">protected</span> <span class="kt">double</span> <span class="nf">distanceBetweenPoints</span><span class="o">(</span><span class="n">LatLongAlt</span> <span class="n">pointA</span><span class="o">,</span> <span class="n">LatLongAlt</span> <span class="n">pointB</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="k">if</span> <span class="o">(</span><span class="n">pointA</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">pointB</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">                <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll">        <span class="kt">double</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">pointA</span><span class="o">.</span><span class="na">getLatitude</span><span class="o">()</span> <span class="o">-</span> <span class="n">pointB</span><span class="o">.</span><span class="na">getLatitude</span><span class="o">();</span>
</span><span class="hll">        <span class="kt">double</span> <span class="n">dy</span>  <span class="o">=</span> <span class="n">pointA</span><span class="o">.</span><span class="na">getLongitude</span><span class="o">()</span> <span class="o">-</span> <span class="n">pointB</span><span class="o">.</span><span class="na">getLongitude</span><span class="o">();</span>
</span><span class="hll">        <span class="kt">double</span> <span class="n">dz</span> <span class="o">=</span> <span class="n">pointA</span><span class="o">.</span><span class="na">getAltitude</span><span class="o">()</span> <span class="o">-</span> <span class="n">pointB</span><span class="o">.</span><span class="na">getAltitude</span><span class="o">();</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span> <span class="o">+</span> <span class="n">dz</span><span class="o">*</span><span class="n">dz</span><span class="o">);</span>
</span><span class="hll"><span class="o">}</span>
</span></pre></div>
</td></tr></table></div>
<p>Whoa! A lot of stuff! Let&#8217;s go through it together:</p>
<div class="highlight-python"><div class="highlight"><pre>public void onFlightModeSelected(View view)
</pre></div>
</div>
<p>This changes the mode of the vehicle when the user changes the selection of the mode selector.</p>
<div class="highlight-python"><div class="highlight"><pre>protected void updateVehicleModesForType(int droneType)
</pre></div>
</div>
<p>This is triggered when the <strong>onDroneEvent</strong> tells us the type of vehicle we&#8217;re dealing with. In the <strong>onDroneEvent</strong>, we get the type of vehicle and load the modes the the vehicle can have.</p>
<div class="highlight-python"><div class="highlight"><pre>// Fired when the vehicle mode changes on the drone.
protected void updateVehicleMode()
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// Fired when the altitude of the drone updates.
protected void updateAltitude()
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// Fired when the speed of the drone updates.
protected void updateSpeed()
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>// A convenience method for calculating the distance between two 3D points.
protected double distanceBetweenPoints(LatLongAlt pointA, LatLongAlt pointB)
</pre></div>
</div>
</div>
<div class="section" id="take-off">
<h2>Take Off!<a class="headerlink" href="#take-off" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s add a button to our app that will allow us to arm, take off and land the vehicle.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;Button</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;120dp&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/btnArmTakeOff&quot;</span>
        <span class="na">android:layout_alignParentRight=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:layout_alignParentEnd=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:layout_column=</span><span class="s">&quot;1&quot;</span>
        <span class="na">android:visibility=</span><span class="s">&quot;invisible&quot;</span>
        <span class="na">android:onClick=</span><span class="s">&quot;onArmButtonTap&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Add a method to our MainActivity to update our button&#8217;s UI depending on the vehicle state:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateArmButton</span><span class="o">()</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">State</span> <span class="n">vehicleState</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">STATE</span><span class="o">);</span>
</span><span class="hll">        <span class="n">Button</span> <span class="n">armButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">btnArmTakeOff</span><span class="o">);</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="n">armButton</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">INVISIBLE</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="hll">                <span class="n">armButton</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="o">(</span><span class="n">vehicleState</span><span class="o">.</span><span class="na">isFlying</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="c1">// Land</span>
</span><span class="hll">                <span class="n">armButton</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;LAND&quot;</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">vehicleState</span><span class="o">.</span><span class="na">isArmed</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="c1">// Take off</span>
</span><span class="hll">                <span class="n">armButton</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;TAKE OFF&quot;</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">vehicleState</span><span class="o">.</span><span class="na">isConnected</span><span class="o">()){</span>
</span><span class="hll">                <span class="c1">// Connected but not Armed</span>
</span><span class="hll">                <span class="n">armButton</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;ARM&quot;</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll"><span class="o">}</span>
</span></pre></div>
</td></tr></table></div>
<p>Add a method to our MainActivity to handle the arm button press:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onArmButtonTap</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
</span><span class="hll">        <span class="n">Button</span> <span class="n">thisButton</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span><span class="n">view</span><span class="o">;</span>
</span><span class="hll">        <span class="n">State</span> <span class="n">vehicleState</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">STATE</span><span class="o">);</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="o">(</span><span class="n">vehicleState</span><span class="o">.</span><span class="na">isFlying</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="c1">// Land</span>
</span><span class="hll">                <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">changeVehicleMode</span><span class="o">(</span><span class="n">VehicleMode</span><span class="o">.</span><span class="na">COPTER_LAND</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">vehicleState</span><span class="o">.</span><span class="na">isArmed</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="c1">// Take off</span>
</span><span class="hll">                <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">doGuidedTakeoff</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span> <span class="c1">// Default take off altitude is 10m</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">vehicleState</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span> <span class="o">{</span>
</span><span class="hll">                <span class="c1">// Connect</span>
</span><span class="hll">                <span class="n">alertUser</span><span class="o">(</span><span class="s">&quot;Connect to a drone first&quot;</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">vehicleState</span><span class="o">.</span><span class="na">isConnected</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vehicleState</span><span class="o">.</span><span class="na">isArmed</span><span class="o">()){</span>
</span><span class="hll">                <span class="c1">// Connected but not Armed</span>
</span><span class="hll">                <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">arm</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class="hll">        <span class="o">}</span>
</span><span class="hll"><span class="o">}</span>
</span></pre></div>
</td></tr></table></div>
<p>Let&#8217;s go back to our good old <strong>onDroneEvent</strong> to link updating our arm button UI to the drone events:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDroneEvent</span><span class="o">(</span><span class="n">String</span> <span class="n">event</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_CONNECTED</span><span class="o">:</span>
                        <span class="n">alertUser</span><span class="o">(</span><span class="s">&quot;Drone Connected&quot;</span><span class="o">);</span>
                        <span class="n">updateConnectedButton</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">());</span>
                        <span class="n">updateArmButton</span><span class="o">();</span>

                        <span class="k">break</span><span class="o">;</span>

                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_DISCONNECTED</span><span class="o">:</span>
                        <span class="n">alertUser</span><span class="o">(</span><span class="s">&quot;Drone Disconnected&quot;</span><span class="o">);</span>
                        <span class="n">updateConnectedButton</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">isConnected</span><span class="o">());</span>
                        <span class="n">updateArmButton</span><span class="o">();</span>
                        <span class="k">break</span><span class="o">;</span>

<span class="hll">                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_UPDATED</span><span class="o">:</span>
</span><span class="hll">                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_ARMING</span><span class="o">:</span>
</span><span class="hll">                        <span class="n">updateArmButton</span><span class="o">();</span>
</span><span class="hll">                        <span class="k">break</span><span class="o">;</span>
</span>
                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">TYPE_UPDATED</span><span class="o">:</span>
                        <span class="n">Type</span> <span class="n">newDroneType</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">drone</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">AttributeType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">newDroneType</span><span class="o">.</span><span class="na">getDroneType</span><span class="o">()</span> <span class="o">!=</span> <span class="k">this</span><span class="o">.</span><span class="na">droneType</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">this</span><span class="o">.</span><span class="na">droneType</span> <span class="o">=</span> <span class="n">newDroneType</span><span class="o">.</span><span class="na">getDroneType</span><span class="o">();</span>
                                <span class="n">updateVehicleModesForType</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">droneType</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>

                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">STATE_VEHICLE_MODE</span><span class="o">:</span>
                        <span class="n">updateVehicleMode</span><span class="o">();</span>
                        <span class="k">break</span><span class="o">;</span>


                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">SPEED_UPDATED</span><span class="o">:</span>
                        <span class="n">updateAltitude</span><span class="o">();</span>
                        <span class="n">updateSpeed</span><span class="o">();</span>
                        <span class="k">break</span><span class="o">;</span>

                <span class="k">case</span> <span class="n">AttributeEvent</span><span class="o">.</span><span class="na">HOME_UPDATED</span><span class="o">:</span>
                        <span class="n">updateDistanceFromHome</span><span class="o">();</span>
                        <span class="k">break</span><span class="o">;</span>
                <span class="k">default</span><span class="o">:</span>
                         <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;DRONE_EVENT&quot;</span><span class="o">,</span> <span class="n">event</span><span class="o">);</span>
                        <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Now run the app and SITL and you should be able to connect, arm, and take off!</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Congratulations! You&#8217;ve just made your first drone app. You can find the full source code for this example on <a class="reference external" href="https://github.com/3drobotics/DroneKit-Android-Starter">Github</a>.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="resources.html" class="btn btn-neutral float-right" title="Additional Resources"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getting_started.html" class="btn btn-neutral" title="Getting Started"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, 3D Robotics.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.1.7beta',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>